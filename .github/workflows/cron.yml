name: Ejecutar cron cada 5 minutos

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

# Garantiza que NUNCA haya dos ejecuciones simultáneas de este workflow
concurrency:
  group: iewc-cron-unico
  cancel-in-progress: false   # si llega otro trigger, se queda en cola hasta que termine el actual

jobs:
  ejecutar:
    runs-on: ubuntu-latest
    # Dale tiempo “largo”. Puedes subirlo si lo necesitas (máx 6h).
    timeout-minutes: 180

    steps:
      - name: Llamar URL (una vez, sin reintentos) y esperar hasta terminar
        shell: bash
        run: |
          URL="https://iewccfdi.facturacionelectronica.mx/timerIEWC.php?plain=1"
          echo "Llamando: $URL"
          # -4 fuerza IPv4 (suele ir mejor con cPanel)
          # --connect-timeout 60: tiempo máx para ESTABLECER la conexión (no limita la ejecución una vez conectado)
          # NO ponemos --max-time ni --retry → una sola llamada y espera lo que tarde
          curl -4sS -A 'GitHubActionsCron/1.0' --connect-timeout 60 "$URL"
